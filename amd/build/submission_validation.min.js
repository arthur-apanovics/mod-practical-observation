define(["jquery","core/notification"],function(a,b){function c(b){var c=0;try{var d=a(b).text();return d=d.replace(/(^\s*)|(\s*$)/gi,""),d=d.replace(/[ ]{2,}/gi," "),d=d.replace(/\n /,"\n"),""==d?0:d.split(" ").length}catch(e){}return c}return{init:function(d){function e(b){var c=a(this).find(".editor_atto_content").prop("id");document.observationContainerStates[c]||k(b),this.removeEventListener("DOMNodeInserted",e,{capture:!0,once:!0})}var f;switch(d){case"learner":f="Please provide information in the attempt field before requesting observation";break;case"observer":f="Please fill in all feedback fields before submitting";break;case"assessor":f="Please provide assessment feedback before saving";break;default:throw new Error("Unsupported submission type: "+d)}var g=a(".editor-container"),h=a('form button[type="submit"]');document.observationContainerStates={};var i=function(a){return document.observationContainerStates[a].valid},j=!1,k=function(e){var k=e.target?a(e.target).find(".editor_atto_content_wrap"):e,l=a(k).find(".editor_atto_content").prop("id");document.observationContainerStates[l]={id:l,valid:!1};var m=function(){if(Object.keys(document.observationContainerStates).length===g.length){document.observationContainerStates[l].valid=Boolean(c(k));var e=Object.keys(document.observationContainerStates).every(i);"assessor"===d&&a('input[name="meets-criteria"]').prop("required","complete"===a('select[name="outcome"]').val()),a(h).prop({title:e?"Submit":f}),e?(a(h).off("click"),j=!1):j||(a(h).on("click",function(){return b.alert("Cannot submit",f),!1}),j=!0)}};a(k).on("keyup keydown propertychange paste",m),a(k).find(".editor_atto_content").on("DOMNodeInserted",function(){a(this).off("DOMNodeInserted"),m()}),"assessor"===d&&a('select[name="outcome"]').on("change",m),m()};a(g).each(function(){if(a(this).find(".editor_atto").length){var b=a(this).find(".editor_atto_content_wrap");k.bind(this)(b)}else this.addEventListener("DOMNodeInserted",e,{capture:!0,once:!0})})}}});