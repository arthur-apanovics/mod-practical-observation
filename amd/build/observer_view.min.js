define(["jquery","core/ajax","core/notification","core/str"],function(a,b,c,d){return{init:function(){var e="table.observer-details",f="a.edit-details",g=a(".personal-details"),h=g.find(e),i=g.find(f),j=function(b){g.find("button[type=submit]").fadeOut(500,function(){a(this).remove()}),g.unwrap(),i.show();var c=h.find("#details-values > td:not(#email)");b?c.each(function(){a(this).removeAttr("data-original_value").html(b[this.id])}):c.each(function(){a(this).html(a(this).data("original_value")).removeAttr("data-original_value")})},k=function(d){d.preventDefault();var e=a(this).find("tr#details-values"),f={token:a('input[name="token"]')[0].value,observerid:e.data("observerid"),fullname:e.find("[name=fullname]").val(),phone:e.find("[name=phone]").val(),position_title:e.find("[name=position_title]").val()};g.find("button[type=submit]").attr("disabled",!0),b.call([{methodname:"mod_observation_observer_update_details",args:f,done:j,fail:function(a){j(null),c.alert("There was a problem","Sorry, something went wrong when updating your details.<br>Please contact an administrator regarding this issue"),window.console.error(a)}}],!0,!1)};i.on("click",function(){h.addClass("editing"),h.find("#details-values > td:not(#email)").each(function(){var b=a(this).text();a(this).attr("data-original_value",b).html(a("<input required/>").attr({type:"text",name:this.id,value:b}))}),g.append(a('<div style="text-align: right; display: none;"><button type="submit">Save</button></div>').fadeIn(500)),i.hide();var b=a('<form id="edit-details-form">').on("submit",k);g.wrap(b)});var l=a("form#requirement-acknowledge #acknowledge_checkbox"),m=a("form#requirement-acknowledge #submit-accept"),n=a("form#requirement-acknowledge #submit-decline"),o="Please read and agree to criteria above before accepting this observation",p="Are you sure you want to decline this observation?";d.get_string("confirm_decline","observation").then(function(a){p=a}),l.attr("disabled",!1),n.attr({disabled:!1,title:"Decline this observation"}),m.attr({title:o}),l.on("change",function(){m.attr({disabled:!this.checked,title:this.checked?null:o})}),n.on("click",function(){if(!window.confirm(p))return!1})}}});